<table class="table table-striped">
    <thead>
        <tr>
            <td class="r"><%= t :'global.vp_mmHg_25C' %></td>
            <td class="r"><%= t :'global.parts_of_100' %></td>
            <td><%= Ingredient.model_name.human %></td>
            <td class="r"><%= t :'global.raw_weight' %></td>
        </tr>
    </thead>
    <tbody>
        <% exceeding_cat_4 = false %>
        <% total_weight = resource.total_weight %>
        <% (  resource.composition).each do |key, ing| %>
            <tr>
                <td class="r"><%= ing.substance.vp_mmHg_25C unless key.is_a?(Symbol) %></td>
                <% fraction =  (ing.amount / total_weight) %>
                <td class="r <%= ( exceeding_cat_4 = :red) if !key.is_a?(Symbol) && ing.substance.ifra_cat_4_limit.to_f > 0 && fraction > ing.substance.ifra_cat_4_limit %>">
                    <% precision = (6 - Math.log10(fraction * 100.0)).round %>
                    <% precision = 5 if precision < 5 %>
                    <%= number_with_precision fraction * 100.0, precision: precision, strip_insignificant_zeros: true %>
                    <span style="font-size:10px;">%</span>
                </td>
                <td>
                    <% if key.is_a?(Symbol) %>
                        <%= ing.dilution.solvent_human_name %>
                    <% else %>
                        <span class="color-<%= ing.substance.character %> ctag"></span>
                        <%= link_to ing.substance, ing.substance %>
                    <% end %>
                </td>
                <td class="r">
                    <% precision = (5 - Math.log10(ing.amount)).round %>
                    <% precision = 1 if precision < 2 %>
                    <% precision += 1 if precision == 3 %>
                    <%= number_with_precision ing.amount, precision: precision, strip_insignificant_zeros: (precision > 1) %> <span class="small-unit">mg</span>
                </td>
            </tr>
        <% end %>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="2" class="r">price <%= number_with_precision resource.price_per_gram %> EUR per 100g</td>
            <td class="r">Total:</td>
            <td class="r"><%= number_with_precision resource.total_weight, precision: 1 %> <span class="small-unit">mg</span></td>
        </tr>
    </tfoot>
</table>
<% if exceeding_cat_4 %>
    <p class="warning"><%= t :'view.hints.exceeding_cat_4' %></p>
<% end %>
