<table class="table table-striped">
    <thead>
        <tr>
            <td class="r">parts of 100</td>
            <td>Ingredient</td>
            <td class="r">raw weight</td>
        </tr>
    </thead>
    <tbody>
        <% exceeding_cat_4 = false %>
        <% (  resource.composition).each do |key, ing| %>
            <tr>
                <% fraction =  (ing.amount / resource.total_weight) %>
                <td class="r <%= ( exceeding_cat_4 = :red) if !key.is_a?(Symbol) && ing.substance.ifra_cat_4_limit.to_f > 0 && fraction > ing.substance.ifra_cat_4_limit %>">
                    <% precision = (6 - Math.log10(fraction * 100.0)).round %>
                    <% precision = 5 if precision < 5 %>
                    <%= number_with_precision fraction * 100.0, precision: precision, strip_insignificant_zeros: true %>
                    <span style="font-size:10px;">%</span>
                </td>
                <td>
                    <% if key.is_a?(Symbol) %>
                        <%= ing.dilution.solvent_human_name %>
                    <% else %>
                        <%= link_to ing.substance, ing.substance %>
                    <% end %>
                </td>
                <td class="r">
                    <% precision = (5 - Math.log10(ing.amount)).round %>
                    <% precision = 1 if precision < 1 %>
                    <%= number_with_precision ing.amount, precision: precision, strip_insignificant_zeros: (precision > 1) %> <span class="small-unit">mg</span>
                </td>
            </tr>
        <% end %>
    </tbody>
    <tfoot>
        <tr>
            <td></td>
            <td class="r">Total:</td>
            <td class="r"><%= number_with_delimiter resource.total_weight.round %> <span class="small-unit">mg</span></td>
        </tr>
    </tfoot>
</table>
<% if exceeding_cat_4 %>
    <p class="warning"><%= t :'view.hints.exceeding_cat_4' %></p>
<% end %>
